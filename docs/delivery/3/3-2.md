# [3-2] Create pre-import validation script

[Back to task list](./tasks.md)

## Description

Create a bash script that validates geospatial data files (GeoJSON, Shapefile, Geodatabase) before import, checking for file existence, readability, CRS detection, field name preview, and record count estimation. This script will help catch issues early and provide visibility into the data before attempting the full import.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-20 12:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-20 13:30:00 | Status Change | Proposed | Agreed | Task approved by User | User |
| 2025-10-20 13:30:01 | Status Change | Agreed | InProgress | Starting implementation of validation script | AI_Agent |
| 2025-10-20 14:00:00 | Status Change | InProgress | Review | Script created and tested, awaiting review | AI_Agent |
| 2025-10-20 14:30:00 | Status Change | Review | InProgress | Updates for GeoJSON support and optimization | AI_Agent |
| 2025-10-20 15:00:00 | Status Change | InProgress | Done | Script completed with GeoJSON support, approved by User | User |

## Requirements

1. Accept geospatial file path as command-line argument (GeoJSON, Shapefile, Geodatabase)
2. Check if file exists and is readable
3. Detect format automatically
4. Detect and report the source CRS
5. List all attribute field names
6. Report estimated record count
7. Display sample data (first 5-10 records)
8. Check for required fields based on our schema mapping
9. Report file size for large files
10. Provide clear error messages for any issues
11. Exit with appropriate exit codes (0 = success, non-zero = failure)

## Implementation Plan

1. Create script: `scripts/validate-geodata.sh`
2. Implement command-line argument parsing
3. Detect file format from extension (geojson, shp, gdb, etc.)
4. Use `ogrinfo` command to inspect file metadata
5. Extract CRS information
6. Extract field names and types
7. Count records
8. Display sample records
9. Check for common field name variations (OBJECTID, PIN, OWNER, SITUS, etc.)
10. Report file size for GeoJSON files
11. Format output for readability with colors
12. Add usage instructions and help text for multiple formats

## Test Plan

**Objective**: Verify the validation script correctly inspects shapefiles and provides useful information

**Test Scope**: Bash script functionality

**Key Test Scenarios**:
1. Script handles non-existent file paths gracefully
2. Script correctly detects CRS from .prj file
3. Script lists all fields from shapefile
4. Script provides accurate record count
5. Script displays sample records
6. Script exits with appropriate codes

**Success Criteria**: 
- Script runs without errors on valid shapefiles
- Script provides clear, formatted output
- Script catches and reports common issues
- Script is documented with usage examples

## Verification

- [x] Script created at `scripts/validate-geodata.sh`
- [x] Script is executable (chmod +x)
- [x] Script accepts geospatial file path as argument
- [x] Script supports multiple formats (GeoJSON, Shapefile, Geodatabase, KML)
- [x] Script detects and reports CRS
- [x] Script lists all attribute fields
- [x] Script provides record count
- [x] Script displays sample data
- [x] Script has clear error messages
- [x] Script includes usage/help text
- [x] Script reports file size for large files
- [ ] Script tested with Montgomery County GeoJSON (ready to test)

## Implementation Notes

- Created comprehensive validation script using `ogrinfo` (GDAL)
- **Renamed** from `validate-shapefile.sh` to `validate-geodata.sh` to reflect multi-format support
- Supports GeoJSON (primary), Shapefile, File Geodatabase, and KML formats
- Auto-detects file format from extension
- For shapefiles: checks for all required companion files (.shp, .shx, .dbf, .prj)
- For GeoJSON: reports file size and warns if > 1GB
- Detects CRS and provides context for common Texas EPSG codes
- Suggests field mappings by checking for common field name variations (OBJECTID, PIN, OWNER, SITUS)
- Provides import time estimates based on record count
- Includes colored output for better readability (✓ ⚠ ✗)
- Graceful error handling with clear messages
- Help text with usage examples for all supported formats

**Dependency Note**: Requires GDAL tools (`ogrinfo`) to be installed:
- Ubuntu/Debian: `sudo apt-get install gdal-bin`
- macOS: `brew install gdal`

**File Format Priority**: GeoJSON is now the primary recommended format due to smaller file size (4-5x smaller than shapefiles) and single-file simplicity.

## Files Modified

- `scripts/validate-geodata.sh` (new, formerly validate-shapefile.sh)

