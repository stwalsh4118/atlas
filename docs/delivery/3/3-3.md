# [3-3] Create field mapping configuration

[Back to task list](./tasks.md)

## Description

Create a configuration system for mapping GeoJSON property names to our database schema columns. Different counties use different naming conventions (OWNER vs ownerName vs OWNER_NAME), so we need a flexible mapping system that can be configured per data source.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-20 12:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-20 15:30:00 | Status Change | Proposed | Agreed | Task approved by User | User |
| 2025-10-20 15:30:01 | Status Change | Agreed | InProgress | Starting implementation of field mapping configuration | AI_Agent |
| 2025-10-20 15:45:00 | Status Change | InProgress | Review | Configuration files created and validated | AI_Agent |
| 2025-10-20 16:00:00 | Status Change | Review | Done | Task approved and completed | User |

## Requirements

1. Define standard field mapping format (JSON or bash variables)
2. Support multiple field name variations for each schema column
3. Include mappings for all tax_parcels columns:
   - parcel_id (from PARCEL, PARCEL_ID, APN, PIN, etc.)
   - owner_name (from OWNER, OWNERNAME, OWNER_NAME, etc.)
   - situs_address (from SITUS, ADDRESS, SITE_ADDR, etc.)
   - acres (from ACRES, ACREAGE, AREA_AC, etc.)
   - assessed_value (from ASSESSED_VALUE, TOTAL_VALUE, etc.)
   - property_class (from CLASS, PROP_CLASS, LAND_USE, etc.)
4. Support default values for missing fields
5. Create Montgomery County specific mapping configuration
6. Document how to create mappings for new counties

## Implementation Plan

1. Create directory: `scripts/mappings/`
2. Create default mapping template: `scripts/mappings/template.json`
3. Create Montgomery County mapping: `scripts/mappings/montgomery-tx.json`
4. Define JSON schema for field mappings:
   ```json
   {
     "county": "montgomery-tx",
     "source_file": "./data/montgomery_parcels.geojson",
     "source_format": "GeoJSON",
     "source_crs": "EPSG:4326",
     "target_crs": "EPSG:4326",
     "field_mappings": {
       "object_id": "OBJECTID",
       "pin": "PIN",
       "owner_name": "ownerName",
       "situs": "situs",
       "acres": null
     }
   }
   ```
5. Create helper script: `scripts/generate-field-mapping.sh` to assist in creating new mappings
6. Document mapping creation process in README

## Test Plan

**Objective**: Ensure field mapping configuration is flexible and usable

**Test Scope**: Configuration file validation

**Key Test Scenarios**:
1. JSON files are valid and parseable
2. Montgomery County mapping includes all required fields
3. Template mapping includes documentation
4. Field name variations cover common county naming patterns
5. Default values are specified where appropriate

**Success Criteria**: 
- Valid JSON configuration files created
- Montgomery County mapping is complete
- Template is documented and reusable
- Configuration format is clear and extensible

## Verification

- [x] Directory `scripts/mappings/` created
- [x] Template mapping file created: `scripts/mappings/template.json`
- [x] Montgomery County mapping created: `scripts/mappings/montgomery-tx.json`
- [x] JSON files are valid and parseable
- [x] All tax_parcels columns have field mappings
- [ ] Helper script created (optional): `scripts/generate-field-mapping.sh` - Not needed, template is sufficient
- [x] Documentation included in mapping files
- [x] README documentation for creating new mappings

## Files Modified

- `scripts/mappings/template.json` (new)
- `scripts/mappings/montgomery-tx.json` (new)
- `scripts/mappings/README.md` (new)

## Implementation Notes

Created comprehensive field mapping configuration system:

1. **Template Configuration** (`template.json`):
   - Complete template with all 20 database columns
   - Extensive comments explaining each field
   - Common field name variations documented inline
   - Usage examples included
   - JSON Schema metadata for validation

2. **Montgomery County Configuration** (`montgomery-tx.json`):
   - All 20 fields mapped from GeoJSON properties to database columns
   - Verified against actual Montgomery County data (325,071 parcels)
   - Includes validation metadata (date, method, sample feature ID)
   - Notes about CRS (already in EPSG:4326, no transformation needed)
   - File size and record count documented

3. **README Documentation** (`README.md`):
   - Overview of field mapping system
   - Complete database schema reference with all columns
   - Step-by-step guide for creating new mappings
   - Common field name variations table
   - Troubleshooting guide
   - Usage examples

**JSON Validation**: Both JSON files validated successfully with Python json.tool

**Design Decisions**:
- Used pure JSON format (no bash variables) for portability and parseability
- Included metadata fields (record_count, file_size_mb) for documentation
- Added validation section to montgomery-tx.json for traceability
- Decided against helper script - template is self-documenting and sufficient
- Field mappings use exact case-sensitive source field names

**Next Task Integration**: These mapping files will be consumed by the import script in task 3-4.


