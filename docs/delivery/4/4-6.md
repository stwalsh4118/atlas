# [4-6] Implement health check endpoints

[Back to task list](./tasks.md)

## Description

Create HTTP handlers for health check endpoints including a basic health check and a readiness check that verifies database connectivity. These endpoints will be used by monitoring systems and load balancers.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-21 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Create handlers package in internal/handlers/
2. Implement GET /health endpoint (basic health check)
   - Returns 200 OK with {"status": "healthy"}
   - Does not check dependencies
3. Implement GET /health/ready endpoint (readiness check)
   - Checks database connectivity
   - Returns 200 OK if database is connected
   - Returns 503 Service Unavailable if database is down
   - Response: {"status": "ready", "database": "connected"}
4. Implement GET /api/v1/info endpoint
   - Returns API metadata (version, uptime, environment)
5. Handle errors gracefully
6. Use structured logging for health check failures

## Implementation Plan

1. Create `api/internal/handlers/health.go`
2. Define HealthHandler struct:
   ```go
   type HealthHandler struct {
       db     *database.Database
       logger *logger.Logger
       startTime time.Time
   }
   ```
3. Implement NewHealthHandler() constructor
4. Implement Health() handler:
   - Always return 200 OK
   - JSON response: {"status": "healthy"}
5. Implement Ready() handler:
   - Call db.Ping() to check connectivity
   - Return 200 if ping succeeds
   - Return 503 if ping fails
   - JSON response with database status
   - Log failures
6. Implement Info() handler:
   - Calculate uptime since startTime
   - Return version (read from const or env)
   - Return environment
   - JSON response with all metadata
7. Add constants for version info
8. Create helper functions for JSON responses

## Test Plan

**Objective**: Verify health check endpoints work correctly with and without database connectivity

**Test Scope**: Health, readiness, and info endpoints with various database states

**Key Test Scenarios**:
1. /health always returns 200 OK
2. /health/ready returns 200 when database is connected
3. /health/ready returns 503 when database is unavailable
4. /health/ready response includes database status
5. /api/v1/info returns correct metadata (version, uptime, env)
6. All endpoints return valid JSON
7. Errors are logged appropriately

**Success Criteria**:
- Health endpoint always succeeds
- Readiness endpoint reflects actual database state
- Info endpoint returns accurate metadata
- Unit tests with mocked database
- Integration tests with real database
- Both test suites pass

## Verification

- [ ] health.go created with HealthHandler
- [ ] Health() handler implemented
- [ ] Ready() handler implemented with database ping
- [ ] Info() handler implemented with metadata
- [ ] Version constant defined
- [ ] JSON response structures defined
- [ ] Error handling implemented
- [ ] Logging added for failures
- [ ] Unit tests created for:
  - Health endpoint
  - Ready endpoint (DB connected)
  - Ready endpoint (DB disconnected)
  - Info endpoint
- [ ] Integration tests with real database
- [ ] All tests pass

## Files Modified

- `api/internal/handlers/health.go` (new)
- `api/internal/handlers/health_test.go` (new)

