# [4-4] Implement structured logging

[Back to task list](./tasks.md)

## Description

Create a logging package that provides structured logging using zerolog. The logger should support different log levels, structured fields, and output formatting appropriate for development and production environments.

This provides consistent, queryable logs throughout the application.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-21 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2025-10-21 00:45:00 | Status Change | Proposed | Agreed | Task approved by User | User |
| 2025-10-21 00:45:01 | Status Change | Agreed | InProgress | Starting logger package implementation | AI_Agent |
| 2025-10-21 00:55:00 | Status Change | InProgress | Review | Logger package implemented with 88.9% test coverage | AI_Agent |
| 2025-10-21 01:00:00 | Status Change | Review | Done | Task approved and complete | User |

## Requirements

1. Create logger package in internal/logger/
2. Initialize zerolog with appropriate configuration
3. Support log levels: debug, info, warn, error, fatal
4. Pretty-print logs in development, JSON in production
5. Include timestamps in all log entries
6. Provide helper functions for common logging patterns
7. Support structured fields (key-value pairs)
8. Configure based on environment (development vs production)

## Implementation Plan

1. Create `api/internal/logger/logger.go`
2. Define Logger struct wrapping zerolog.Logger
3. Implement New() function:
   ```go
   func New(env string) *Logger {
       // Configure zerolog based on environment
       // Development: ConsoleWriter with colors
       // Production: JSON output
   }
   ```
4. Set up console writer for development:
   - Pretty colors and formatting
   - Human-readable timestamps
5. Set up JSON writer for production:
   - Machine-parsable format
   - ISO8601 timestamps
6. Configure log level based on environment:
   - Development: debug
   - Production: info
7. Add helper methods:
   - Debug(msg string, fields map[string]interface{})
   - Info(msg string, fields map[string]interface{})
   - Warn(msg string, fields map[string]interface{})
   - Error(msg string, err error, fields map[string]interface{})
8. Add contextual logging support for request IDs

## Test Plan

**Objective**: Verify logging works correctly in both development and production modes

**Test Scope**: Logger initialization, output formatting, and structured fields

**Key Test Scenarios**:
1. Logger initializes correctly in development mode (console output)
2. Logger initializes correctly in production mode (JSON output)
3. Log levels work correctly (debug, info, warn, error)
4. Structured fields are included in log output
5. Timestamps are included in all log entries
6. Error logging includes error details

**Success Criteria**:
- Logger produces console output in development
- Logger produces JSON in production
- All log levels work correctly
- Structured fields appear in output
- Unit tests verify logger behavior

## Verification

- [x] logger.go created with Logger struct
- [x] New() function implemented with environment-based config
- [x] Console writer configured for development
- [x] JSON writer configured for production
- [x] Log level set based on environment (debug for dev, info for prod)
- [x] Helper methods implemented for all log levels (Debug, Info, Warn, Error, Fatal)
- [x] Structured field support working
- [x] Timestamp included in all logs
- [x] With() and WithRequestID() methods for contextual logging
- [x] Unit tests created for:
  - Logger initialization (dev and prod modes)
  - Different log levels
  - Structured fields
  - Environment switching
  - Request ID context
  - JSON output validation
  - Nil fields handling
- [x] Unit tests pass (88.9% coverage)

## Implementation Notes

- Logger package successfully implemented using zerolog
- Development mode: pretty console output with colors and timestamps
- Production mode: JSON output for machine parsing
- Log levels: debug (dev) / info (prod) with methods for all levels
- Structured fields support for rich contextual logging
- With() method for creating child loggers with additional context
- WithRequestID() helper for adding request IDs to log context
- GetZerolog() provides access to underlying zerolog.Logger for advanced use
- Test coverage: 88.9% (excellent coverage of all logging paths)
- All 11 unit test cases pass successfully

## Files Modified

- `api/internal/logger/logger.go` (new)
- `api/internal/logger/logger_test.go` (new)

