# [4-4] Implement structured logging

[Back to task list](./tasks.md)

## Description

Create a logging package that provides structured logging using zerolog. The logger should support different log levels, structured fields, and output formatting appropriate for development and production environments.

This provides consistent, queryable logs throughout the application.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-21 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Create logger package in internal/logger/
2. Initialize zerolog with appropriate configuration
3. Support log levels: debug, info, warn, error, fatal
4. Pretty-print logs in development, JSON in production
5. Include timestamps in all log entries
6. Provide helper functions for common logging patterns
7. Support structured fields (key-value pairs)
8. Configure based on environment (development vs production)

## Implementation Plan

1. Create `api/internal/logger/logger.go`
2. Define Logger struct wrapping zerolog.Logger
3. Implement New() function:
   ```go
   func New(env string) *Logger {
       // Configure zerolog based on environment
       // Development: ConsoleWriter with colors
       // Production: JSON output
   }
   ```
4. Set up console writer for development:
   - Pretty colors and formatting
   - Human-readable timestamps
5. Set up JSON writer for production:
   - Machine-parsable format
   - ISO8601 timestamps
6. Configure log level based on environment:
   - Development: debug
   - Production: info
7. Add helper methods:
   - Debug(msg string, fields map[string]interface{})
   - Info(msg string, fields map[string]interface{})
   - Warn(msg string, fields map[string]interface{})
   - Error(msg string, err error, fields map[string]interface{})
8. Add contextual logging support for request IDs

## Test Plan

**Objective**: Verify logging works correctly in both development and production modes

**Test Scope**: Logger initialization, output formatting, and structured fields

**Key Test Scenarios**:
1. Logger initializes correctly in development mode (console output)
2. Logger initializes correctly in production mode (JSON output)
3. Log levels work correctly (debug, info, warn, error)
4. Structured fields are included in log output
5. Timestamps are included in all log entries
6. Error logging includes error details

**Success Criteria**:
- Logger produces console output in development
- Logger produces JSON in production
- All log levels work correctly
- Structured fields appear in output
- Unit tests verify logger behavior

## Verification

- [ ] logger.go created with Logger struct
- [ ] New() function implemented with environment-based config
- [ ] Console writer configured for development
- [ ] JSON writer configured for production
- [ ] Log level set based on environment
- [ ] Helper methods implemented for all log levels
- [ ] Structured field support working
- [ ] Timestamp included in all logs
- [ ] Unit tests created for:
  - Logger initialization
  - Different log levels
  - Structured fields
  - Environment switching
- [ ] Unit tests pass

## Files Modified

- `api/internal/logger/logger.go` (new)
- `api/internal/logger/logger_test.go` (new)

