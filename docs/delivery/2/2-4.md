# [2-4] Create GORM model with custom geometry type

[Back to task list](./tasks.md)

## Description

Create the TaxParcel GORM model with a custom Polygon geometry type that implements GORM's Scanner and Valuer interfaces. This allows GORM to handle the geometry column while using PostGIS for spatial operations.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-20 00:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Define custom Polygon type that implements sql.Scanner and driver.Valuer
2. Create TaxParcel struct with GORM tags matching database schema
3. Include all fields from Montgomery County GeoJSON data
4. Support GeoJSON parsing for geometry data
5. Include helper methods for common operations
6. Add proper GORM table name configuration

## Implementation Plan

1. Create `api/internal/models/geometry.go`:
   - Define Polygon type struct
   - Implement Scanner interface (reads from DB)
   - Implement Valuer interface (writes to DB)
   - Add GeoJSON marshaling/unmarshaling

2. Create `api/internal/models/tax_parcel.go`:
   - Define TaxParcel struct with all fields
   - Add GORM field tags
   - Add JSON tags for API responses
   - Implement TableName() method
   - Add validation tags if needed

3. Map all Montgomery County fields to Go struct:
   - Use appropriate Go types (int, string, time.Time)
   - Make fields nullable where appropriate (use pointers)
   - Use proper GORM column tags

4. Reference the research from task 2-1 for implementation patterns

## Test Plan

**Objective**: Verify GORM model compiles and geometry type works with database

**Environment**: Local PostgreSQL with PostGIS enabled

**Test Scope**: Model definition and basic type functionality

**Key Test Scenarios**:
1. **Compilation**: Go code compiles without errors
2. **Type Safety**: Polygon type implements required interfaces
3. **GORM Integration**: Can create GORM DB instance with model
4. **Serialization**: Can marshal/unmarshal geometry to/from database format

**Success Criteria**:
- Code compiles with no errors
- GORM recognizes TaxParcel as a valid model
- Geometry type can be scanned from database
- Type checks pass for Scanner and Valuer interfaces

## Verification

- [ ] `api/internal/models/geometry.go` created with Polygon type
- [ ] Polygon implements sql.Scanner interface
- [ ] Polygon implements driver.Valuer interface
- [ ] `api/internal/models/tax_parcel.go` created with TaxParcel struct
- [ ] All Montgomery County fields mapped correctly
- [ ] GORM tags match database column names
- [ ] Code compiles without errors
- [ ] No linter errors

## Files Modified

- `api/internal/models/geometry.go` (new)
- `api/internal/models/tax_parcel.go` (new)
- `api/go.mod` (possibly updated with geometry library dependencies)
- `api/go.sum` (possibly updated)

